# SPARQL Cookbook for KB Vocabulary

## Basic Queries

### Find all documents of a type

```sparql
PREFIX kb: <http://example.org/kb/vocab#>

SELECT ?doc ?title WHERE {
    ?doc a kb:GroupMeeting ;
         kb:title ?title .
}
```

### Find documents by tag

```sparql
PREFIX kb: <http://example.org/kb/vocab#>
PREFIX skos: <http://www.w3.org/2004/02/skos/core#>

# Direct tag
SELECT ?doc WHERE {
    ?doc kb:hasTag :tag/projects/web .
}

# Including child tags
SELECT ?doc WHERE {
    ?doc kb:hasTag ?tag .
    ?tag skos:broader* :tag/projects .
}
```

## People Queries

### Find all meetings with a person

```sparql
SELECT ?meeting ?date WHERE {
    ?meeting a kb:Meeting ;
             kb:hasAttendee :person/John_Smith ;
             dcterms:created ?date .
} ORDER BY DESC(?date)
```

### Find frequent collaborators

```sparql
SELECT ?person (COUNT(?meeting) as ?count) WHERE {
    ?meeting kb:hasAttendee :person/John_Smith ;
             kb:hasAttendee ?person .
    FILTER(?person != :person/John_Smith)
} GROUP BY ?person ORDER BY DESC(?count)
```

## Todo Queries

### Open todos for a person

```sparql
SELECT ?todo ?desc ?due WHERE {
    GRAPH :inferred {
        ?todo a kb:Todo ;
              kb:assignedTo :person/John_Smith ;
              kb:description ?desc .
        OPTIONAL { ?todo kb:due ?due }
    }
    ?source kb:isCompleted false .
    ?todo kb:derivedFrom ?source .
}
```

### Overdue todos

```sparql
SELECT ?todo ?desc ?due ?person WHERE {
    GRAPH :inferred {
        ?todo a kb:Todo ;
              kb:due ?due ;
              kb:description ?desc ;
              kb:assignedTo ?person .
        FILTER(?due < NOW())
    }
}
```

## Relationship Queries

### Stale relationships

```sparql
SELECT ?person ?lastDate WHERE {
    GRAPH :inferred {
        :person/Me kb:hasRelationship ?rel .
        ?rel kb:withPerson ?person ;
             kb:lastInteraction ?lastDate ;
             kb:isStale true .
    }
} ORDER BY ?lastDate
```

### Relationship network

```sparql
SELECT ?p1 ?p2 ?strength WHERE {
    GRAPH :inferred {
        ?p1 kb:hasRelationship ?rel .
        ?rel kb:withPerson ?p2 ;
             kb:relationshipStrength ?strength .
        FILTER(?strength > 0.5)
    }
}
```

## Document Analysis

### Recent documents mentioning a topic

```sparql
SELECT ?doc ?date ?title WHERE {
    ?doc kb:mentionedIn :person/John_Smith ;
         dcterms:created ?date ;
         dcterms:title ?title .
    FILTER(?date > "2024-10-01"^^xsd:date)
} ORDER BY DESC(?date)
```

### Tag frequency

```sparql
SELECT ?tag (COUNT(?doc) as ?count) WHERE {
    ?doc kb:hasTag ?tag .
    ?tag kb:autoGenerated false .
} GROUP BY ?tag ORDER BY DESC(?count)
```

## Advanced Patterns

### Find implicit teams

```sparql
# People who frequently appear in same meetings
SELECT ?p1 ?p2 (COUNT(?meeting) as ?shared) WHERE {
    ?meeting kb:hasAttendee ?p1 ;
             kb:hasAttendee ?p2 .
    FILTER(?p1 < ?p2)  # Avoid duplicates
} GROUP BY ?p1 ?p2
HAVING(?shared > 5)
ORDER BY DESC(?shared)
```

### Document clusters by shared tags

```sparql
SELECT ?doc1 ?doc2 (COUNT(?tag) as ?common) WHERE {
    ?doc1 kb:hasTag ?tag .
    ?doc2 kb:hasTag ?tag .
    FILTER(?doc1 < ?doc2)
} GROUP BY ?doc1 ?doc2
HAVING(?common > 3)
```

## Performance Tips

1. Use `GRAPH` to limit search scope
2. Add type constraints early in patterns
3. Use `FILTER` sparingly
4. Consider creating materialized views for complex queries
